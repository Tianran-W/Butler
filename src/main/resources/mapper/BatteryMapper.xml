<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.BatteryMapper">

    <resultMap id="batteryVOResultMap" type="com.example.vo.BatteryVO">
        <id property="materialId" column="material_id"/>
        <result property="modelName" column="material_name"/>
        <result property="snCode" column="sn_code"/>
        <result property="status" column="status"/>
        <result property="lifespanCycles" column="lifespan_cycles"/>
        <result property="currentCycles" column="current_cycles"/>
    </resultMap>

    <select id="findAllBatteries" resultMap="batteryVOResultMap">
        SELECT
            m.material_id,
            m.material_name,
            m.sn_code,
            m.status,
            bi.lifespan_cycles,
            bi.current_cycles
        FROM
            tb_material m
        JOIN
            tb_battery_info bi ON m.material_id = bi.material_id
        WHERE
            m.status != '已报废'
        ORDER BY m.material_id
    </select>

    <select id="findBatteryById" resultMap="batteryVOResultMap">
        SELECT
            m.material_id,
            m.material_name,
            m.sn_code,
            m.status,
            bi.lifespan_cycles,
            bi.current_cycles
        FROM
            tb_material m
        JOIN
            tb_battery_info bi ON m.material_id = bi.material_id
        WHERE
            m.material_id = #{materialId}
    </select>

    <select id="findCategoryIdByName" resultType="java.lang.Integer">
        SELECT category_id FROM tb_material_category WHERE category_name = #{categoryName}
    </select>

    <update id="updateMaterialStatus">
        UPDATE tb_material SET status = #{status} WHERE material_id = #{materialId}
    </update>

</mapper>